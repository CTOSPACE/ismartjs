/*! iSmartjs version:1.0.0 2014-07-14 http://www.ismartjs.com Email:daigua1028@gmail.com QQ: 175309744*/

!function(a){var b=" var out = {\n     output : [],\n     print : function(str){\n          this.output.push(str);\n     },\n     println : function(str){\n          this.print(str == null ? '' : str + '\\n');\n     }\n };\n",c=function(c){var d=[];d.push(b);for(var e=[],f=!1,g=function(b){var c=e.join("");if("script"==b)c=c.replace(/\slt\s/gi,"<").replace(/\sgt\s/gi,">"),d.push(c),e=[];else{if(""==a.trim(c))return void(e=[]);c=c.replace(/'/gi,"\\'"),d.push("out.print('"+c+"');"),e=[]}},h=!1,i=!1,j=0;j<c.length;j++){var k=c[j];if("\n"!=k){if("\r"!=k)if("#"==k&&"}"==c[j+1]&&i)g("output"),j++;else if(i)e.push(k);else switch(k){case"{":if("#"==c[j+1]){i=!0,j++,g(f?"script":"output");break}if("%"==c[j+1]&&!f){g("output"),j++,f=!0;break}e.push(k);break;case"%":if("}"==c[j+1]&&f){h&&(e.push(");"),h=!1),j++,f=!1,g("script");break}e.push(k);break;case"=":f&&j-2>=0&&"{"==c[j-2]&&"%"==c[j-1]?(e.push("out.print("),h=!0):e.push(k);break;default:e.push(k)}}else f?e.push(k):(g("output"),e.push("\\n"),g("output"))}return g("output"),d.push("return out.output.join('');"),d.join("\n")};a.template={compile:c}}(jQuery),function(a){var b="_SMART_",c="s",d={initial:"initial",prepared:"prepared",building:"building",build:"build",running:"running",run:"run",made:"made"},e=["made","load","loading","close"],f="s",g=window.Smart=function(c){this.node=c||a(),this.node.data(b,this),this._dataTable={},this.lifeStage=d.initial,this.options={};var f=this;a.each(e,function(a,b){f.on(b,function(a){a.stopPropagation()})})};g.defineKey=c,g.extend=function(b,c){return 1==arguments.length&&(c=b,b=g),a.extend(b,c)},g.fn={extend:function(b){a.isArray(b)||(b=[b]),a.each(b,function(a,b){g.extend(g.prototype,b)})}};var h=Array.prototype.slice,i=Object.prototype.toString;g.extend({disableNode:function(a,b){null==b&&(b=!0),b?a.attr("disabled","disabled").addClass("disabled"):a.removeAttr("disabled").removeClass("disabled")},clickDeferred:function(a,b){a.click(function(c){g.disableNode(a);var d=b(c);null==d||!1 in d?g.disableNode(a,!1):d.always(function(){g.disableNode(a,!1)})})}}),g.extend({SLICE:h,TO_STRING:i,noop:function(){},uniqueId:function(){return"SMART_"+(new Date).getTime()},removeArrayElement:function(b,c){var d=a.inArray(b,c);return-1==d?c:c.slice(0,d).concat(c.splice(d+1))},equalArray:function(a,b){if(0==a.length&&0==b.length)return!0;if(a.length!=b.length)return!1;for(var c in a)if(a[c]!=b[c])return!1;return!0},isEmpty:function(b){return null==b?!0:"[object String]"==i.call(b)?0==a.trim(b).length:"[object Array]"==i.call(b)?0==b.length:!1},isSmart:function(a){return void 0==a?!1:a.constructor&&a.constructor==g?!0:!1},isWidgetNode:function(a){return void 0!==a.attr(c)},isDeferred:function(b){return b&&"done"in b&&a.isFunction(b.done)},map:function(b,c){for(var d=[],e=0;e<b.length;e++){var f=b[e];a.isFunction(c)?d.push(c(f)):"[object String]"==i.call(c)&&d.push(f[c])}return d},serializeToObject:function(b){if(!b.is("form"))return{};var c={},d=b.serializeArray();return a.each(d,function(b,d){var e=d.name,f=d.value,g=c[e];return void 0===g?void(c[e]=f):void(a.isArray(g)?g.push(f):c[e]=[g,f])}),c},formData:function(b){if(b=a(b),1==b.size()&&b.is("form"))return new FormData(b[0]);var c=new FormData;return b.each(function(){var b=a(this),d=b.attr("name");b.is(":file")?a.each(this.files,function(a,b){c.append(d,b)}):b.is(":checkbox,:radio")?b.prop("checked")&&c.append(d,b.val()):c.append(d,b.val())}),c},httpSuccess:function(a){try{return!a.status&&"file:"===location.protocol||a.status>=200&&a.status<300||304===a.status||1223===a.status||0===a.status}catch(b){}return!1},optionAttrName:function(a,b){return f+"-"+a+"-"+b},deferredQueue:function(b){function c(e){if(e==b.length)return void d.resolve();var f=b[e];if(!a.isFunction(f))return void c(e+1);var g=f();return g?void g.done(function(){c(e+1)}).fail(function(){d.reject()}):void c(e+1)}var d=a.Deferred();return 1==arguments.length?"array"!=a.type(b)&&(b=[b]):arguments.length>1&&(b=h.call(arguments)),c(0),d.promise()},pick:function(b){var c=g.of();return b.each(function(){var b=a(this);c.add(g.isWidgetNode(b)?b:g.of(b).children())}),c},of:function(c){if(g.isSmart(c))return c;if(void 0===c||0==c.size())return new g;if(c.size()>1){var d=g.of();return a.each(c,function(b,c){d.add(a(c))}),d}var d=c.data(b);return d?d:(d=new g(c),c.data(b,d),d)},realPath:function(){function a(a){var b=a.match(c);return b?b[0]:""}function b(a){for(a=a.replace(d,"/");a.match(e);)a=a.replace(e,"/");return a}var c=/[^?#]*\//,d=/\/\.\//g,e=/\/[^/]+\/\.\.\//;return function(c,d){return/^(http|https|ftp|):.*$/.test(c)?c:(c=void 0===d?c:a(d)+c,b(c))}}()}),function(){var a=window.console||{info:g.noop,debug:g.noop,warn:g.noop};g.extend({info:function(){a.info.apply(a,arguments)},error:function(){a.error.apply(a,arguments)},warn:function(){a.warn.apply(a,arguments)}})}(),g.extend(g.prototype,{extend:function(b){return a.extend(this,b)},each:function(b){this.node.each(function(c,d){d=a(d),b.call(g.of(d),c,d)})},parent:function(){var b=this.node.parent().closest("["+c+"]");return 0==b.size()&&(b=g.of(a(window))),g.of(b)},isWindow:function(){return 1==this.node.size()?this.node[0]==window:!1},add:function(a){g.isSmart(a)&&(a=a.node);var b=this;a.each(function(a,c){b.node=b.node.add(c)})},size:function(){return this.node.size()},pick:function(b){var c=this.node.children();if(0==c.size())return g.of();var d=g.of();return a.map(c,function(c){if(c=a(c),c.is(b))d.add(c);else{if(c.is("input,textarea,radio,checkbox,img,select"))return;d.add(g.of(c).pick())}}),d},find:function(b){var c=this.node.find(b),d=g.of();return c.each(function(){d.add(a(this))}),d},children:function(){var b=this.node.children();if(0==b.size())return g.of();var d=g.of();return a.map(b,function(b){if(b=a(b),void 0!==b.attr(c))d.add(b);else{if(b.is("input,textarea,radio,checkbox,img,select"))return;d.add(g.of(b).children())}}),d}}),g.extend(g.prototype,{setNode:function(a){return this.node.empty(),this._insertNode(a)},prependNode:function(a){return this._insertNode(a,"prepend")},appendNode:function(a){return this._insertNode(a)},_insertNode:function(b,c){try{return"string"==a.type(b)&&(b=a(b)),this.node[c||"append"](b),g.pick(b).make(),this}catch(d){this.node[c||"append"](b),g.error(d)}}}),g.extend(g.prototype,{setContext:function(a){return this.hasContext=!0,this._context=a,this},setContextSmart:function(b){return this.node.each(function(){g.of(a(this))._context_smart_=b}),this},context:function(){var b=function(a){if(a.hasContext)return a;var c=a.parent();return null==c?null:b(c)};return function(){var c;return"_context_smart_"in this?c=this._context_smart_:(c=b(this),this.setContextSmart(c)),c.isWindow()?null:c._context.apply(this,a.makeArray(arguments))}}(),dataTable:function(a,b,c){var d=this._getDataTableKey(a,b);return void 0===c?this._dataTable[d]:(this._dataTable[d]=c,this)},removeDataTable:function(a,b){return delete this._dataTable[this._getDataTableKey(a,b)],this},_getDataTableKey:function(a,b){return g.isEmpty(a)?(g.error("dataTable必须有命名空间"),void this.alert("dataTable必须有命名空间")):g.isEmpty(b)?(g.error("dataTable必须有key"),void this.alert("dataTable必须有key")):a+"-"+b},clearDataTable:function(){return this._dataTable={},this}}),function(){function b(a,b){a._inherited_api_map={};for(var c in b){var d=b[c];for(var e in d)e in a&&(a._inherited_api_map[d[e]]=a[e]),a[e]=d[e]}a.inherited=function(b){var c=arguments.callee.caller,d=a._inherited_api_map[c];return d.apply(this,b)}}var e={},f={},j={},k={onData:g.noop,onPrepare:g.noop,onBuild:g.noop,onDestroy:g.noop,onRefresh:g.noop};g.widgetExtend=function(b,c,d){"[object String]"==i.call(b)&&(b={id:b});var g=b.id;j[g]=b,d&&(e[g]=d),c&&(f[g]=a.extend(a.extend({},k),c))},g.widgetOptionsExtend=function(b,c){var d=j[b];d&&(d.defaultOptions=a.extend(d.defaultOptions||{},c))},g.getWidgetDef=function(a){return j[a]},g.widgetExtend({id:"smart",options:"key, data, null"},{onData:function(){var a=this;a.options.smart.data&&a.data(a.options.smart.data)}},{dataGetter:g.noop,dataSetter:function(b){var c=a.type(b);if("boolean"==c||"number"==c||"string"==c)return this.node.is("input[type='text'],select,textarea,input[type='password'],input[type='email'],input[type='number']")?void this.node.val(b):this.node.is("input[type='radio']")?void(b+""==this.node.val()&&this.node.prop("checked",!0)):void this.node.html(b);if("array"==c&&this.node.is("input[type='checkbox']")){var d=this.node.val();-1!=a.inArray(d,b)&&this.node.prop("checked",!0)}},data:function(){if(0==arguments.length)return this.dataGetter?this.dataGetter.apply(this,h.call(arguments)):void 0;var a=h.call(arguments),b=this.options.smart.key,c=a;if(b){var d=a[0];c=[void 0==d?null:d[b]]}null==c?c=this.options.smart["null"]:c,this.dataSetter.apply(this,c)},build:g.noop,refresh:function(){var b=this;a.each(this._widgetListeners,function(a,c){c.onRefresh&&c.onRefresh.call(b)})}});var l=function(b,c){if(c.options&&c.options.length){var d,e=c.options,f=void 0;"[object Array]"===i.call(e)?(d=a.trim(e[0]).split(","),e.length>1&&(f=e[1])):d=a.trim(e).split(",");var h={};for(var j in d){var k=a.trim(d[j]),l=!1;/^ctx:.*$/.test(k)&&(k=k.substring(4),l=!0);var m=!1,n=g.optionAttrName(c.id,k),o=b.node.attr(n);/^ctx:.*$/.test(o)&&(o=o.substring(4),m=!0),h[k]=l||m?b.context(o):o}f&&"[object Object]"===i.call(f)&&(h=a.extend(f,h));var p={};c.defaultOptions&&a.extend(p,c.defaultOptions),a.extend(p,h),b.options[c.id]=p}},m=function(h){function i(){h.lifeStage=d.made,h.trigger("made")}var k=h.node,m=k.attr(c);if(void 0==m)return h.makeChildren();""==m&&(m="smart"),m=m.replace(/ /g,""),m=m.split(","),"smart"!=m[0]&&m.unshift("smart"),h._widgetListeners=[];var n=[],o=[];a.each(m,function(a,b){b in e&&n.push(e[b]),b in j&&o.push(j[b]),b in f&&h._widgetListeners.push(f[b])}),b(h,n),h.options={},a.each(o,function(a,b){l(h,b)}),h.on("option",function(b,c,d,e){-1!=a.inArray(c,m)&&(h.options[c][d]=e,b.stopPropagation())}),a.each(h._widgetListeners,function(a,b){"onPrepare"in b&&b.onPrepare.call(h)}),h.lifeStage=d.prepared;var p=[];return a.each(h._widgetListeners,function(a,b){"onBuild"in b&&p.push(function(){return b.onBuild.call(h)})}),p.push(function(){return h.makeChildren()}),a.each(h._widgetListeners,function(a,b){"onData"in b&&p.push(function(){return b.onData.call(h)})}),g.deferredQueue(p).always(function(){i()})};g.prototype.makeChildren=function(){var b=this.children();if(0==b.size())return a.Deferred().resolve();var c=[];return b.each(function(){var a=this;c.push(function(){return a.make()})}),g.deferredQueue(c)},g.prototype.make=function(){try{if(this.lifeStage==d.made)return g.warn("该控件已经创建过了！"),a.Deferred().resolve();var b=this.size();if(0==b)return a.Deferred().resolve();if(b>1){var c=[];return this.each(function(){var a=this;c.push(function(){return a.make()})}),g.deferredQueue(c)}return m(g.of(this.node))}catch(e){g.error("make Smart error: "+e)}finally{return a.Deferred().resolve()}}}(),g.extend(g.prototype,{alert:function(a){window.alert(a)}}),g.extend(g.prototype,{on:function(a,b,c){return this.node.on(a,b,c),this},off:function(a,b,c){return this.node.off(a,b,c),this},trigger:function(a,b){return this.node.trigger(a,b),this}}),function(){g.extend(g.prototype,{onMade:function(a){var b=this;return this.lifeStage==d.made&&a.call(b),this.on("made",function(){a.apply(b,h.call(arguments))}),this}})}(),function(){var b=/\{([^}]+)}/gi,c={startTip:"正在操作，请稍候……",successTip:"操作成功",errorTip:"操作失败",silent:!1,getErrorMsg:function(a,b){return"404"==a.status?b+" "+a.statusText:a.responseText}};g.ajaxSetup=function(b){a.extend(c,b)},a.each(["get","post","put","remove","update"],function(d,e){g.prototype[e]=function(d,f,g,j,k){"[object Object]"==i.call(g)&&(j=g,g=null),j=a.extend(a.extend({},c),j||{}),"remove"==e&&(e="delete"),g=g||"json";var l=a.Deferred();j.silent||this.trigger("ajaxStart",[j.startTip]);var m=this;d=d.replace(b,function(a,b){return m.context(b)});var n={url:d,type:e,dataType:g,data:f,cache:!1};return void 0==f||f.constructor!=FormData&&f.constructor!=File||(n.contentType=!1,n.processData=!1),a.extend(n,k||{}),a.ajax(n).done(function(){l.resolve.apply(l,h.call(arguments)),j.silent||m.trigger("ajaxSuccess",[j.successTip])}).fail(function(a){l.reject.apply(l,h.call(arguments)),j.silent||m.trigger("ajaxError",[j.errorTip,c.getErrorMsg(a,d)])}).always(function(){l.always.apply(l,h.call(arguments)),j.silent||m.trigger("ajaxComplete")}),l}})}(),g.loadFiles=function(){var b=[],c={},d=function(d,e){var f=a.Deferred(),h=g.realPath(d,e);if(h in c)return c[h].push(f),f;if(-1!=a.inArray(h,b)||0!=a("script[src$='"+h+"']").size())return f.resolve(),f;var i=document.createElement("script");if(i.type="text/javascript",i.src=h,h in c){var j=c[h];j.push(f)}else c[h]=[f];return i.onload=function(){b.push(h);var d=c[h];delete c[h],a.each(d,function(a,b){b.resolve()})},i.onerror=function(){g.error("未能加载："+d),b.push(h),f.resolve()},document.getElementsByTagName("head")[0].appendChild(i),f},e=function(c,d){var e=a.Deferred(),f=g.realPath(c,d);if(-1!=a.inArray(f,b)||0!=a("link[href$='"+f+"']").size())return e.resolve(),e;var h=document.createElement("link");return h.rel="stylesheet",h.href=f,document.getElementsByTagName("head")[0].appendChild(h),b.push(f),e.resolve(),e},f=function(a,b){return/^.*\.css([?,#].*){0,1}$/.test(a)?e(a,b):/^.*\.js([?,#].*){0,1}$/.test(a)?d(a,b):void 0};return function(b,c){var d=a.Deferred();if(void 0===b)return void d.resolve();a.isArray(b)||(b=b.split(","));var e=function(){b.length?f(b.shift(),c).done(function(){e()}).fail(function(){d.resolve()}):d.resolve()};return e(),d}}()}(jQuery),function(){Smart.widgetExtend({id:"cds",options:"ctx:cs,ck,dk,c-msg,e-msg,r",defaultOptions:{"c-msg":"确认进行此操作吗？","e-msg":"请选择你要操作的数据？",r:"true",ck:"id"}},{onPrepare:function(){var a=this;this.on("submit-done",function(){"true"==a.options.cds.r&&a.options.cds.cs.refresh()})}},{getSubmitData:function(a){function b(){var b={};b[d.options.cds.dk]=c,a.resolve(b)}if(this.options.cds.dk){var c=this.options.cds.cs.getCheckedData(this.options.cds.ck);if(Smart.isEmpty(c))return this.options.cds["e-msg"]&&this.alert(this.options.cds["e-msg"]),a.reject();var d=this;this.options.cds["c-msg"]&&this.confirm(this.options.cds["c-msg"],{sign:"warning"}).done(function(){b()}).fail(function(){a.reject()})}else this.alert("没有配置dk参数"),a.reject()}})}(),function(a){var b="*["+Smart.optionAttrName("check","role")+"='i']",c="*["+Smart.optionAttrName("check","role")+"='h']",d=Smart.optionAttrName("check","path");Smart.widgetExtend({id:"check",options:"i-checked-class, turn, multiple, ctx:checkall-h, h-checked-class, check-path",defaultOptions:{turn:"on","i-checked-class":"warning",multiple:"true","h-checked-class":"s-ui-checked","check-path":"false"}},{onPrepare:function(){var c=this;this.node.delegate(b,"click",function(b){"on"==c.options.check.turn&&c._toggleCheck(a(this),b)});var d=[];this.dataTable("check","checkallHandles",d);var e=a("*[s-check-role='checkall-h']",this.node);e.size()>0&&(d.push(e),this.node.delegate("*[s-check-role='checkall-h']","click",function(b){c._toggleCheckAll(a(this)),b.stopPropagation()})),this.options.check["checkall-h"]&&(d.push(this.options.check["checkall-h"]),this.options.check["checkall-h"].click(function(b){c._toggleCheckAll(a(this)),b.stopPropagation()})),this.node.delegate(b,"unchecked",function(a){e.size()&&c._uncheckHandle(e),c.options.check["checkall-h"]&&c._uncheckHandle(c.options.check["checkall-h"]),c.options.check["checkall-h"]&&c.options.check["checkall-h"].prop("checked",!1),a.stopPropagation()})},onRefresh:function(){var b=this.dataTable("check","checkallHandles"),c=this;a.each(b,function(){c._uncheckHandle(a(this))})}},{turn:function(b){this.options.check.turn=b,"on"!=b?a(c,this.node).prop("disabled",!0):a(c,this.node).prop("disabled",!1)},_toggleCheckAll:function(a){var b;a.hasClass(this.options.check["h-checked-class"])?(b=!1,a.removeClass(this.options.check["h-checked-class"])):(b=!0,a.addClass(this.options.check["h-checked-class"])),b?this.checkAll():this.uncheckAll()},checkAll:function(){this._checkHandlesByFlag(!0);var c=this;a(b,this.node).each(function(){c._checkNode(a(this))})},uncheckAll:function(){this._checkHandlesByFlag(!1);var c=this;a(b,this.node).each(function(){c._uncheckNode(a(this))})},_checkHandlesByFlag:function(b){var c=this.dataTable("check","checkallHandles"),d=this;a.each(c,function(){b?d._checkHandle(a(this)):d._uncheckHandle(a(this))})},_checkHandle:function(a){a.addClass(this.options.check["h-checked-class"]),a.is(":checkbox")&&a.prop("checked",!0)},_uncheckHandle:function(a){a.removeClass(this.options.check["h-checked-class"]),a.is(":checkbox")&&a.prop("checked",!1)},getChecked:function(){if("true"==this.options.check.multiple){var c=[];return a.each(a(b+"."+this.options.check["i-checked-class"],this.node),function(){c.push(Smart.of(a(this)))}),c}var d=a(b+"."+this.options.check["i-checked-class"],this.node);return 0==d.size()?null:Smart.of(a(d[0]))},getCheckedData:function(b){if("true"==this.options.check.multiple){var c=[];return a.each(this.getChecked(),function(){c.push(b?this.data()[b]:this.data())}),c}var d=this.getChecked();return null==d?null:d.data()},_toggleCheck:function(b,d){if(!(d&&a(c,b).size()>0)||a(d.target).is(c)){var e=this.options.check["i-checked-class"];b.hasClass(e)?this._uncheck(b):this._check(b)}},_check:function(c){if(!c.hasClass(this.options.check["i-checked-class"])){var d=this;"false"==this.options.check.multiple&&a(b,this.node).not(c).each(function(){d._uncheck(a(this))}),this._checkNode(c),"true"==this.options.check["check-path"]&&this._checkNextUntil(c)}},_checkNextUntil:function(b){var c=b.attr(d),e=b.nextUntil(":not(*["+d+"^="+c+"/])"),f=this;e.each(function(){f._checkNode(a(this))})},_uncheck:function(a){a.hasClass(this.options.check["i-checked-class"])&&(this._uncheckNode(a),"true"==this.options.check["check-path"]&&(this._uncheckPrevUntil(a),this._uncheckNextUntil(a)))},_uncheckNextUntil:function(b){var c=b.attr(d),e=b.nextUntil(":not(*["+d+"^="+c+"/])"),f=this;e.each(function(){f._uncheckNode(a(this))})},_uncheckPrevUntil:function(a){var b=a.attr(d);if(void 0!=b)for(var c=b.split("/"),e=a;c.length>2;){c.pop();var f=c.join("/"),g="*["+d+"="+f+"]",h=e.prevUntil(g).last().prev();0==h.size()&&(h=e.prev()),h.is(g)&&(e=h,this._uncheckNode(h))}},_checkNode:function(b){if(!b.hasClass(this.options.check["i-checked-class"])){b.addClass(this.options.check["i-checked-class"]).trigger("checked");var d=a(c,b);0!=d.size()&&(d.addClass(this.options.check["h-checked-class"]),d.is(":checkbox")&&setTimeout(function(){d.prop("checked")||d.prop("checked",!0)},1))}},_uncheckNode:function(b){if(b.hasClass(this.options.check["i-checked-class"])){b.removeClass(this.options.check["i-checked-class"]).trigger("unchecked");var d=a(c,b);0!=d.size()&&(d.removeClass(this.options.check["h-checked-class"]),d.is(":checkbox")&&setTimeout(function(){d.prop("checked")&&d.prop("checked",!1)},1))}}})}(jQuery),function(){Smart.widgetExtend({id:"dataSubmit",options:"ctx:data,url,type,listener",defaultOptions:{type:"post"}},{onPrepare:function(){var a=this;Smart.clickDeferred(this.node,$.proxy(this.submit,this)),this.on("submit-done",function(b){b.stopPropagation(),a.options.listener&&a.options.listener.done&&a.options.listener.done.apply(null,Smart.SLICE.call(arguments,1))}),this.on("submit-fail",function(b){b.stopPropagation(),a.options.listener&&a.options.listener.fail&&a.options.listener.fail.apply(null,Smart.SLICE.call(arguments,1))})}},{getSubmitData:function(a){var b=this.options.dataSubmit.data;a.resolve($.isFunction(b)?b():b)},submit:function(){var a=this,b=$.Deferred();this.getSubmitData(b);var c=$.Deferred();return b.done(function(b){a[a.options.dataSubmit.type](a.options.dataSubmit.url,b).done(function(){a.trigger.apply(a,["submit-done"].concat($.makeArray(arguments))),c.resolve()}).fail(function(){a.trigger.apply(a,["submit-fail"].concat($.makeArray(arguments))),c.reject()})}).fail(function(){c.reject()}),c}})}(),function(){Smart.widgetExtend({id:"datac"},null,{dataSetter:function(){var a=Smart.SLICE.call(arguments),b=Smart.optionAttrName("datac","ig");this.children().each(function(){var c=this.node.attr(b);"true"!=c&&""!=c&&this.data.apply(this,a)})}})}(),function(){Smart.extend({eventAction:function(){var getActionSmart=function(a){if(a.action)return a;var b=a.parent();return null==b||b.isWindow()?null:getActionSmart(b)};return function(smart,script){var actionSmart=getActionSmart(smart),script_body=[];if(script_body.push("var e = arguments[1];"),script_body.push(script),null==actionSmart){var window_body=[];return window_body.push("(function(){"),window_body.push("      return function(){"),window_body.push("          "+script_body.join("\n")),window_body.push("      }"),window_body.push("})()"),eval(window_body)}return actionSmart.action(script_body.join("\n"))}}()});var bindEvent=function(a,b,c){Smart.isEmpty(b)||Smart.isEmpty(c)||(c=Smart.eventAction(a,c),a.node[b](function(b){var d=c.call(a,b);if(null!=d){if(Smart.isDeferred(d)){var e=$(b.target);Smart.disableNode(e),d.always(function(){Smart.disableNode(e,!1)})}return d}}))};Smart.widgetExtend({id:"event",options:"type,action"},{onPrepare:function(){var a=this.options.event.action,b=this.options.event.type;bindEvent(this,b,a)}}),Smart.widgetExtend({id:"click",options:"action"},{onPrepare:function(){var a=this.options.click.action;bindEvent(this,"click",a)}}),Smart.widgetExtend({id:"change",options:"action"},{onPrepare:function(){var a=this.options.change.action;bindEvent(this,"change",a)}}),Smart.widgetExtend({id:"focus",options:"action"},{onPrepare:function(){var a=this.options.focus.action;bindEvent(this,"focus",a)}}),Smart.widgetExtend({id:"blur",options:"action"},{onPrepare:function(){var a=this.options.blur.action;bindEvent(this,"blur",a)}}),Smart.widgetExtend({id:"dblclick",options:"action"},{onPrepare:function(){var a=this.options.dblclick.action;bindEvent(this,"dblclick",a)}}),Smart.widgetExtend({id:"mouseover",options:"action"},{onPrepare:function(){var a=this.options.mouseover.action;bindEvent(this,"mouseover",a)}}),Smart.widgetExtend({id:"mousemove",options:"action"},{onPrepare:function(){var a=this.options.mousemove.action;bindEvent(this,"mousemove",a)}}),Smart.widgetExtend({id:"mouseout",options:"action"},{onPrepare:function(){var a=this.options.mouseout.action;bindEvent(this,"mouseout",a)}}),Smart.widgetExtend({id:"stopPropagation",options:"events",defaultOptions:{events:"click"}},{onPrepare:function(){this.node.on(this.options.stopPropagation.events,function(a){a.stopPropagation()})}})}(),function(){var a=Smart.optionAttrName("check","path");Smart.widgetExtend({id:"loopCheckCombine"},{onPrepare:function(){this.on("row-add",function(b,c,d,e){for(var f=[""],g=0;e>=g;g++)f.push(g);c.attr(a,f.join("/"))}),this.trigger("option",["check","check-path","true"])}})}(),function(a){function b(b,d){return a("*["+c+"='"+b+"']",d)}var c=Smart.optionAttrName("loop","role");Smart.widgetExtend({id:"loop",options:"type,tree-c,tree-indent-width,tree-indent-str",defaultOptions:{"tree-c":"children",indent:20}},{onPrepare:function(){var a=b("empty",this.node),c=b("row",this.node);this.node.empty(),this.dataTable("loop","emptyRow",a),this.dataTable("loop","loopRow",c)}},{empty:function(){this.node.empty()},addRow:function(a,b,c){var d=this._getRow();if(b){var e=d.find('*[s-loop-tree-role="indent"]');if(this.options.loop["tree-indent-str"]){for(var f=this.options.loop["tree-indent-str"],g=1;b>g;g++)f+=f;e.prepend(f)}else e.size()>=0&&e.css("text-indent",this.options.loop.indent*b+"px")}var h=Smart.of(d);h.on("made",function(){h.data(a)}),this[(c||"append")+"Node"](d),this.trigger("row-add",[d,a,b,c])},addRows:function(a,b,c){b=void 0==b?0:b;for(var d=0;d<a.length;d++)if(this.addRow(a[d],b,c),"tree"==this.options.loop.type){var e=a[d][this.options.loop["tree-c"]];e&&e.length&&this.addRows(e,b+1,c)}},_getRow:function(){var a=this.dataTable("loop","loopRow").clone();return a},_addEmptyRow:function(){var a=this.dataTable("loop","emptyRow");a&&this.node.append(a.clone())},setRows:function(a){return this.empty(),0==a.length?void this._addEmptyRow():void this.addRows(a)},dataSetter:function(b){a.isArray(b)||Smart.error("loop控件接受的赋值参数必须是数组"),this.setRows(b)}}),Smart.widgetExtend({id:"row",options:"ctx:render"},null,{dataSetter:function(a){this.dataTable("row","data",a),this.inherited([a]),this.options.row.render&&this.options.row.render.call(this,this.node)},dataGetter:function(){return this.dataTable("row","data")}})}(jQuery),function(){Smart.widgetExtend("nda",{onPrepare:function(){this.node.find("*[name]").each(function(){var a=$(this);Smart.isWidgetNode(a)||a.attr(Smart.defineKey,"");var b=Smart.optionAttrName("smart","key");Smart.isEmpty(a.attr(b))&&a.attr(b,a.attr("name"))})}})}(),function(){var a={build:{id:"build",resourceKey:"__original_build_resource_key__"},data:{id:"data",resourceKey:"__original_data_resource_key__"}};Smart.widgetExtend({id:"resource",options:"data-res,ctx:data-form,ctx:data-adapter,ctx:data-cascade,data-cascade-key,build-res,ctx:build-form,ctx:build-adapter,ctx:build-cascade,build-cascade-key"},{onPrepare:function(){if(this.options.resource["data-cascade"]){this.options.resource[a.data.resourceKey]=this.options.resource["data-res"];var b=this;this.options.resource["data-cascade"].change(function(){b._cascadeLoad(a.data.id)})}if(this.options.resource["build-cascade"]){this.options.resource[a.build.resourceKey]=this.options.resource["build-res"];var b=this;this.options.resource["build-cascade"].change(function(){b._cascadeLoad(a.build.id)})}},onBuild:function(){return this._onBuild()},onData:function(){return this._onData()},onRefresh:function(){return this._onData()}},{_cascadeLoad:function(b){var c=this.options.resource[b+"-cascade"],d=c.val(),e=b+"-res",f=this.options.resource[a[b].resourceKey],g=b+"-cascade-key";if(this.options.resource[e]=f.replace("{val}",d),this.options.resource[g]){var h={};h[this.options.resource[g]]=d,this.dataTable("resource","param",h)}return this._load(this.options.resource[e],h,b)},_load:function(b,c,d){var e=$.Deferred();if(void 0==b)return e.resolve();var f="json";if(/^.+:.+$/.test(b)){var g=b.indexOf(":");f=b.substring(g),b=b.substring(g+1)}var h=this,i=this.options.resource[d+"-form"],j=this.options.resource[d+"-adapter"],c=this.dataTable("resource","param")||{};if(i){var k=Smart.serializeToObject(i);$.extend(c,k)}return this.get(b,c,f).done(function(b){$.isFunction(j)&&(b=j(b)),d==a.build.id?h.build(b):d==a.data.id&&h.data(b),e.resolve()}).fail(function(){e.reject()}),e.promise()},_onBuild:function(){if(this.options.resource["build-cascade"]){if(Smart.isWidgetNode(this.options.resource["build-cascade"])){var b=$.Deferred(),c=this;return Smart.of(this.options.resource["build-cascade"]).onMade(function(){c._cascadeLoad(a.build.id),b.resolve()}),b.promise()}return this._cascadeLoad(a.build.id)}return this._load(this.options.resource["build-res"],{},a.build.id)},_onData:function(){if(this.options.resource["data-cascade"]){if(Smart.isWidgetNode(this.options.resource["data-cascade"])){var b=$.Deferred(),c=this;return Smart.of(this.options.resource["data-cascade"]).onMade(function(){c._cascadeLoad(a.data.id),b.resolve()}),b.promise()}return this._cascadeLoad(a.data.id)}return this._load(this.options.resource["data-res"],{},a.data.id)},buildRefresh:function(){return this._onBuild()}})}(),function(){var token=0,TABLE_FN_KEY="_TPL_FN_";Smart.widgetExtend("tpl",{onPrepare:function(){var tplText=this.node.html();this.node.empty();var compiledText=$.template.compile(tplText),scripts=[];scripts.push("(function(){"),scripts.push("      return function(){"),scripts.push(compiledText),scripts.push("      }"),scripts.push("})();//@ sourceURL="+token++ +"_template.js");var script=scripts.join("\n"),fn=eval(script);this.dataTable("tpl",TABLE_FN_KEY,fn)}},{dataSetter:function(a){this._insertData(a)},appendData:function(a){this._insertData(a,"appendNode")},prependData:function(a){this._insertData(a,"prependNode")},_insertData:function(a,b){var c=this.dataTable("tpl",TABLE_FN_KEY),d=c.call(a);this[b||"setNode"](d)}})}(),function($){var SCRIPT_RE=/<script((?:.|\s)*?)>((?:.|\s)*?)<\/script>/gim,META_RE=/<meta(.*?)\/>/gim,META_ITEM_RE=/(\S+)=(['"])([^\2]*?)\2/gi,META_VALUE_RE=/\{%=(.*)%}/gi,parseMeta=function(a){var b={};if(a.replace(META_ITEM_RE,function(a,c,d,e){b[c]=e}),b.args&&b.args.length){var c=$.trim(b.args);b.args=[],$.each(c.split(","),function(a,c){b.args.push($.trim(c))})}return b},parseHtml=function(a){var b=[],c=[],d={};return a=a.replace(META_RE,function(a,b){return d=parseMeta(b),""}),a=a.replace(SCRIPT_RE,function(a,d,e){var f=/src=(\S+)?/gi.exec(d);return f&&2==f.length&&c.push(f[1].replace(/['"]/g,"")),b.push(e),""}),{meta:d,html:a,scriptTexts:b,scriptSrcs:c}},process=function(result,href,loadArgs){var html=result.html;loadArgs=loadArgs||{};var scriptTexts=result.scriptTexts,scripts=[],meta=result.meta,argsScripts=[],metaScripts=[];if(scripts.push("(function(){"),scripts.push("    return function(){"),meta.args){var windowOpenArgsVar="__WINDOW_OPEN_ARGS_VAR__";$.each(meta.args,function(a,b){var c="var "+b+" = arguments[0]['"+b+"'];";metaScripts.push("var "+b+" = arguments[1]['"+b+"'];"),argsScripts.push(c),scripts.push(c)})}if(scripts.push("var S = this;"),scripts.push(scriptTexts.join("\n")),scripts.push("			return function(key){"),scripts.push("				try{"),scripts.push("					key += ';//@ sourceURL="+href+"_context.js'"),scripts.push("					return eval(key);"),scripts.push("				}catch(e){Smart.error(e);}"),scripts.push("			};"),scripts.push("		};"),scripts.push("})();//@ sourceURL="+href+".js"),"true"==meta.template){var compiledFnBody=[];compiledFnBody.push("(function(){"),compiledFnBody.push("   return function(){\n"),compiledFnBody.push(argsScripts.join("\n")),compiledFnBody.push($.template.compile(html)),compiledFnBody.push("   }"),compiledFnBody.push("})();//@ sourceURL="+href+"_template.js");var fn=eval(compiledFnBody.join("\n"));html=fn.call(this,loadArgs),html=html.replace(/\n{2,}/gm,"\n")}this._WNODE=$(html);var that=this;this._WNODE.find("*[id]").add(this._WNODE.filter("*[id]")).each(function(){var a=$(this).attr("id");$(this).attr("id",that.trueId(a)).attr("_id_",a)}),this.meta=meta;var metaScript=metaScripts.join("\n");metaScript+="\n  try{\n return eval(arguments[0]);\n}catch(e){\nreturn null}";var metaScript=new Function(metaScript);$.each(meta,function(a,b){"args"!=a&&(meta[a]=b.replace(META_VALUE_RE,function(a,b){return metaScript.apply(this,[b,loadArgs])}))});var scriptFn=eval(scripts.join("\n")),context=scriptFn.call(this,loadArgs);if(this.setContext(context),this.setNode(this._WNODE),-1!=href.indexOf("#")){var anchor=href.substring(href.indexOf("#"));this.scrollTo(anchor)}},CURRENT_WINDOW_ID=0,ON_BEFORE_CLOSE_FN_KEY="_onBeforeCloseFns_",EVENT_ON_CACHE="_EVENT_ON_CACHE",STOP_ANCHOR_SCROLLIN_KEY="_stop_anchor_scrollin_";Smart.widgetExtend({id:"window",options:"href"},{onData:function(){var a=$.Deferred(),b=this.options.window;return b&&b.href?(this.load(b.href).always(function(){a.resolve()}),a.promise()):a.resolve()},onPrepare:function(){this._WINDOW_ID="_w_"+CURRENT_WINDOW_ID++,this[ON_BEFORE_CLOSE_FN_KEY]=[],this[EVENT_ON_CACHE]=[],this.node.attr("id")||this.node.attr("id",this._WINDOW_ID)}},{refresh:function(){return this.load.apply(this,[this.currentHref()].concat(this.dataTable("window","_loadArgs")))},currentHref:function(){return this.dataTable("window","href")},load:function(a){this._clean(),this.dataTable("window","loadState",!0),this.trigger("loading");var b=$.Deferred(),c=$.makeArray(arguments);this.dataTable("window","_loadArgs",c);var d=this;return this.dataTable("window","href",a),this.get(a,null,"text").done(function(e){var f=parseHtml(e),g=f.scriptSrcs;Smart.loadFiles(g,a).done(function(){process.apply(d,[f].concat(c)),d._listenAnchorPos()}).fail(function(){Smart.error(a+"的依赖处理失败")}).always(function(){d.trigger("load"),b.resolve(d)})}).fail(function(){d.trigger("load")}),b},setMeta:function(a,b){this.meta[a]=b,this.trigger("meta",a,b)
},scrollTo:function(a){var b=a;"string"==$.type(a)&&(b=this.N(a));var c=$.Deferred();if(0!=b.size()){var d=b.position(),e=this.node.scrollTop();this.node.animate({scrollTop:e+d.top+"px"},400,"easeOutQuint",function(){c.resolve()})}else c.resolve();return c},scrollToAnchor:function(a){this.dataTable("window",STOP_ANCHOR_SCROLLIN_KEY,!0);var b=this;return this.scrollTo("#"+a).done(function(){b.removeDataTable("window",STOP_ANCHOR_SCROLLIN_KEY)})},_listenAnchorPos:function(){var a=this._getAnchorNodes(),b=a.size();if(b>0){var c=this,d=function(){if(!c.dataTable("window",STOP_ANCHOR_SCROLLIN_KEY))for(var d=$(this).innerHeight(),e=0;b>e;e++){var f=$(a[e]),g=f.position().top;if(d/3>=g&&g>=0)return void c.trigger("anchor.scrollin",f.attr("_id_"))}};this.on("clean",function(){c.node.unbind("scroll",d)}),this.node.scroll(d).on("anchor.scrollin",function(a){a.stopPropagation()})}},getAnchors:function(){var a=this.dataTable("window","_anchors_");return a||(a=[],this.dataTable("window","_anchors_",a),this._getAnchorNodes().each(function(){var b=$(this);a.push({id:b.attr("_id_"),title:b.attr("title")})})),a},_getAnchorNodes:function(){var a=Smart.optionAttrName("window","role");return this.node.find("*["+a+"='a']")},_clean:function(){this.trigger("clean"),this.clearDataTable(),this[ON_BEFORE_CLOSE_FN_KEY]=[];var a=this;$.each(this[EVENT_ON_CACHE],function(b,c){a.off.apply(a,c)})},preClose:function(){var a=$.Deferred(),b=this[ON_BEFORE_CLOSE_FN_KEY];return b.length>0?(Smart.deferredQueue(b.reverse()).then(function(){a.resolve()},function(){a.reject()}),a.promise()):a.resolve()},open:function(){var a=$.Deferred(),b=$.Event("open",{deferred:a,smart:this});return this.trigger(b,$.makeArray(arguments)),a},close:function(){var a=this,b=arguments;a.clearDataTable();var c=$.Deferred();c.done(function(){a.node.remove()});var d=$.Event("close",{deferred:c});a.trigger(d,Smart.SLICE.call(b)),d.deferred.resolve&&d.deferred.resolve()},closeWithConfirm:function(){var a=this,b=arguments;return this.preClose().done(function(){a.close.apply(a,Smart.SLICE.call(b))})},onBeforeClose:function(a){return this[ON_BEFORE_CLOSE_FN_KEY].push(a),this},action:function(a){var b=[];return b.push("(function(){"),b.push("      return function(){"),b.push("          "+a),b.push("      }"),b.push("})()"),this.context(b.join("\n"))},_tidyId:function(a){var b=this;return a=a.replace(/<\w+\s+(id=['"])(.+)(['"])\s*?[^>]*?>/gi,function(a,c,d,e){return c+b.trueId(d)+e})},S:function(a){var b=Smart.of(this.N(a));return b.setContextSmart(this),b},N:function(a){var b=[];if(a=a.split(","),1==a.length)a=a[0],"#"==a.charAt(0)&&(a="#"+this.trueId(a.substring(1)));else{for(var c=0;c<a.length;c++){var d=$.trim(a[c]);"#"==d.charAt(0)&&(d="#"+this.trueId(d.substring(1))),b.push(d)}a=b.join(",")}return this._WNODE.filter(a).add(this._WNODE.find(a))},trueId:function(a){return this._WINDOW_ID+"_"+a},on:function(a,b,c){return this.dataTable("window","loadState")&&this[EVENT_ON_CACHE].push([a,b,c]),this.inherited([a,b,c])}})}(jQuery),function(a){var b=1e3,c={};Smart.UI={zIndex:function(){return b++},template:function(a){return c[a].clone()},loadTemplate:function(b){return a.get(b,function(b){b=a("<div />").append(b),a("*[s-ui-role]",b).each(function(){var b=a(this);c[b.attr("s-ui-role")]=b})})},backdrop:function(){var b,c=[],d=!1;return function(e){b||(b=a(Smart.UI.template("backdrop")).clone(),b.appendTo("body"));var f=a.Deferred();if(e=void 0==e?!0:e){var g=Smart.UI.zIndex();if(c.push(g),b.show().css("z-index",g),d)return f.resolve();var h=function(){f.resolve()};d=!0;var i=a.support.transition;i&&b[0].offsetWidth,b.addClass("in"),i?b.one(a.support.transition.end,h).emulateTransitionEnd(150):h()}else{if(c.pop(),c.length)return b.css("zIndex",c[c.length]),f.resolve();var h=function(){b.hide(),f.resolve()};d=!1,b.removeClass("in"),a.support.transition?b.one(a.support.transition.end,h).emulateTransitionEnd(150):h()}return f.promise()}}()}}(jQuery),function(){Smart.UI.contextmenu={target:null};var a,b="disabled";Smart.widgetExtend({id:"contextmenu",options:"ctx:target,ctx:filter"},{onPrepare:function(){var a=this.options.contextmenu.target,c=this;a&&this.bindTarget(a),this.node.delegate("li","click",function(a){$("ul",$(this)).size()>0||(c.hide(),a.stopPropagation())}),$(document).click(function(){c.hide()}),this.node.find("li ul").each(function(){var a=$(this),c=a.parent();c.mouseover(function(){$(this).hasClass(b)||a.css("z-index",Smart.UI.zIndex()).show().position({of:c,my:"left top",at:"right-3 top+3",collision:"flip flip"})}),c.mouseleave(function(){a.fadeOut()})})}},{bindTarget:function(a){var b=this;a.bind("contextmenu",function(a){return b.show(a,$(this)),!1})},show:function(b,c){if(a&&a!=this&&a.hide(),a=this,Smart.UI.contextmenu.target=Smart.of(c),this.options.contextmenu.filter){var d=this.node.find("li[menuId]"),e=this;d.size()&&d.each(function(){var a=$(this),b=a.attr("menuId");0==e.options.contextmenu.filter(b,a)?e._disableMenu(a):e._enableMenu(a)})}$(this.node).show().css({zIndex:Smart.UI.zIndex(),position:"absolute"}).position({of:b,my:"left top",at:"left top",collision:"flip flip"})},hide:function(){this.node.fadeOut(200)},disableMenuById:function(a){this._disableMenu(this.node.find("li[menuId='"+a+"']"))},_disableMenu:function(a){a.addClass(b),$("i, span",a).click(function(a){a.stopPropagation()})},enableMenuById:function(a){this._enableMenu(this.node.find("li[menuId='"+a+"']"))},_enableMenu:function(a){a.removeClass(b),$("i, span",a).unbind("click")}})}(),function(a){var b=Smart.optionAttrName("dropdown","val"),c=Smart.optionAttrName("dropdown","title"),d="*["+Smart.optionAttrName("dropdown","role")+"='title']";Smart.widgetExtend({id:"dropdown",options:"e,name,ctx:t",defaultOptions:{e:"request.data"}},{onPrepare:function(){var e=this;this.node.delegate("*["+b+"]","click",function(){var f=a(this).attr(b);if(e.options.dropdown.t&&e.options.dropdown.t.val(f),e.options.dropdown.e){var g={};null==e.options.dropdown.name?g=f:g[e.options.dropdown.name]=f,e.trigger(e.options.dropdown.e,[g])}var h=a(this).attr(c)||a(this).text();a(d,e.node).html(h)})}})}(jQuery),function(a){var b=function(a,b,c,d){d=d||10,a=1>a?1:a;var e=Math.ceil(c/b),f=a-Math.floor(d/2);1>f&&(f=1);var g=f+d;g>e&&(g=e,f=g-d,1>f&&(f=1));var h=0;f>1&&(h=f-1);var i=0;e>g&&(i=g+1);var j=0,k=0;a>1&&(j=a-1),e>a&&(k=a+1);var l=(a-1)*b+1,m=l+b-1;return m>c&&(m=c),{page:a,pageSize:b,totalCount:c,startPage:f,endPage:g,startNum:l,endNum:m,startPrePage:h,endNextPage:i,prePage:j,nextPage:k,totalPage:e}};Smart.widgetExtend({id:"pagination",options:"pagekey, pskey, totalkey, showsize, start-p, end-n, disabled-c, active-c, pre, next, event",defaultOptions:{pagekey:"page",pskey:"pageSize",totalkey:"total",showsize:11,"start-p":"&laquo;","end-n":"&raquo;",pre:"‹",next:"›","disabled-c":"disabled","active-c":"active",event:"request.data","ed-pk":"page"}},{onPrepare:function(){}},{dataSetter:function(a){var c=b(a[this.options.pagination.pagekey],a[this.options.pagination.pskey],a[this.options.pagination.totalkey],a[this.options.pagination.showsize]);this.node.empty();var d=this._createLi(this.options.pagination["start-p"]);c.startPrePage<=0?d.addClass(this.options.pagination["disabled-c"]):d.click(function(){f._triggerPage(c.startPrePage)}),this.node.append(d);var e=this._createLi(this.options.pagination.pre);c.prePage<=0?e.addClass(this.options.pagination["disabled-c"]):e.click(function(){f._triggerPage(c.prePage)}),this.node.append(e);for(var f=this,g=c.startPage;g<=c.endPage;g++)!function(a){var b=f._createLi(a);a==c.page?b.addClass(f.options.pagination["active-c"]):b.click(function(){f._triggerPage(a)}),f.node.append(b)}(g);var h=this._createLi(this.options.pagination.next);c.nextPage<=0?h.addClass(this.options.pagination["disabled-c"]):h.click(function(){f._triggerPage(c.nextPage)}),this.node.append(h);var i=this._createLi(this.options.pagination["end-n"]);c.endNextPage<=c.endPage?i.addClass(this.options.pagination["disabled-c"]):i.click(function(){f._triggerPage(c.endNextPage)}),this.node.append(i)},_triggerPage:function(a){var b={};b[this.options.pagination["ed-pk"]]=a,this.trigger(this.options.pagination.event,[b])},_createLi:function(b){var c=a("<li />"),d=a("<a href='javascript:;'>"+b+"</a>");return c.append(d),c}})}(jQuery),function(a){Smart.widgetExtend({id:"select",options:"form",defaultOptions:{form:"id:name,title"}},{onPrepare:function(){var a=this.node.children();this.dataTable("select","originalOptions",a),this.options.select.form=this.options.select.form.split(":"),this.options.select.form[1]=this.options.select.form[1].split(",")}},{build:function(b){if(!a.isArray(b))return void Smart.error("构建select选项所需的数据必须是数组");this.node.empty(),this.node.append(this.dataTable("select","originalOptions"));for(var c in b)this.node.append(this._createOption(b[c]))},_createOption:function(b){var c=b[this.options.select.form[0]],d=b[this.options.select.form[1][0]];d||2!=this.options.select.form[1].length||(d=b[this.options.select.form[1][1]]);var e=a('<option value="'+c+'">'+d+"</option>");return e}})}(jQuery),function(a){Smart.widgetExtend({id:"submit",options:"ctx:action,ctx:done,ctx:fail,ctx:always,reset",defaultOptions:{reset:"false"}},{onPrepare:function(){var b=this;this.dataTable("submit","action",this.node.attr("action")),this.dataTable("submit","method",this.node.attr("method")||"post"),this.dataTable("submit","enctype",this.node.attr("enctype")||"application/x-www-form-urlencoded");var c=this.node.find(":submit");this.node[0].onsubmit=function(d){d.stopPropagation();try{var e=a.Deferred();Smart.disableNode(c),e.done(function(){Smart.disableNode(c,!1)}),b.submit(e)}catch(d){Smart.error(d)}return!1}}},{submit:function(b){if(!("action"in this.options.submit)&&Smart.isEmpty(this.dataTable("submit","action")))return b.resolve();var c=this;if(this.options.submit.action){var d=function(){var a=c.options.submit.action.call(c);Smart.isDeferred(a)?a.always(function(){b.resolve()}):b.resolve()};return void("validate"in this?this.validate().done(d):d())}var e;switch(this.dataTable("submit","enctype")){case"multipart/form-data":e=Smart.formData(this.node);break;case"application/x-www-form-urlencoded":e=Smart.serializeToObject(this.node)}var f=function(){c[c.dataTable("submit","method")](c.dataTable("submit","action"),e).done(function(a){c.options.submit.done&&c.options.submit.done.call(c,a),"true"==c.options.submit.reset&&c.node[0].reset()}).fail(function(){c.options.submit.done&&c.options.submit.done.apply(c,a.makeArray(arguments))}).always(function(){c.options.submit.always&&c.options.submit.always.call(c),b.resolve()})};"validate"in this?this.validate().done(function(){f()}).fail(function(){b.resolve()}):f()}})}(jQuery),function($){function Validation(a,b,c,d){this.varMap={},this.item=c,this.value=b,this.smart=a,this._interrupt=!1,this._validateItemMap=d}function executeExp(smart,exp,nodeMsg,item,validateItemMap){function processMsg(a,b){return null==b?"":(0==b.indexOf("success:")?(msgLevel=LEVELS.success,b=b.substring(8)):0==b.indexOf("error:")?(msgLevel=LEVELS.error,b=b.substring(6)):0==b.indexOf("warning:")?(msgLevel=LEVELS.warning,b=b.substring(8)):msgLevel=msgLevel||LEVELS.error,void(validMsg=a.processMsg(b)))}function resolve(){return deferred.resolve(validMsg,msgLevel)}function reject(){return deferred.reject(validMsg,msgLevel)}function validate(i){function processSuccess(a){return msgLevel=LEVELS.success,processMsg(validation,a||msg[successCode]),validation.interrupted()?void resolve():void validate(i+1)}if(i==validSegs.length)return void resolve();var vs=validSegs[i],s=/^(\w+)\((.*)\)$/g.exec(vs),method=s[1],validation=new Validation(smart,item.value,item,validateItemMap);validation.putVar("label",item.label);var argStr=".valid.call(validation";3==s.length&&""!=$.trim(s[2])&&(argStr+=","+s[2]);var validator=optionValidatorMap[method]||getValidator(method);if(!validator)return msgLevel=LEVELS.error,reject();var rs=eval("validator"+argStr+")"),count=methodCount[method];void 0==count?count=0:count++,methodCount[method]=count;var methodCountMsg=nodeMsg[method+"#"+count]||{},methodMsg=nodeMsg[method]||{},msg=methodCountMsg.msg||methodMsg.msg||"",successCode=methodCountMsg.successCode||methodMsg.successCode||"1";return msg=$.extend($.extend({},validator.msg),msg),rs==successCode?void processSuccess():"object"==$.type(rs)&&"done"in rs?void rs.done(function(a,b){a==successCode?processSuccess(b):(processMsg(validation,b||msg[a]),reject())}):(msgLevel=LEVELS.error,processMsg(validation,msg[rs]),reject())}var validSegs=getValidSegs(exp),deferred=$.Deferred(),validMsg="",msgLevel=LEVELS.error,optionValidatorMap=smart.dataTable("valid","validatorMap")||{},methodCount={};return validate(0),deferred.promise()}function getValidSegs(a){for(var b=[],c=0,d=[],e=0;e<a.length;e++){var f=a[e];","!=f||0!=c?("("!=f||c||c++,")"==f&&c&&c--,d.push(f)):(b.push(d.join("")),d=[])}return b.push(d.join("")),b}function addValidators(a){$.isArray(a)||(a=[a]);for(var b in a){var c=a[b];addValidator(c)}}function setValidatorMsg(a){$.isArray(a)||(a=[a]),$.each(a,function(a,b){var c=validatorMap[b.id];c&&(c.msg=$.extend(c.msg||{},b.msg))})}function addValidator(a){validatorMap[a.id]=a}function getValidator(a){return validatorMap[a]}var DEFAULT_MSG={},VALID_NODE_ERROR_ATTR=Smart.optionAttrName("valid","error"),VALID_NODE_LABEL_ATTR=Smart.optionAttrName("valid","label"),VALID_NODE_WARNING_ATTR=Smart.optionAttrName("valid","warning"),VALID_NODE_SELECTOR="*["+VALID_NODE_ERROR_ATTR+"]:not('disabled'),*["+VALID_NODE_WARNING_ATTR+"]:not('disabled')",VALID_NODE_ID_ATTR=Smart.optionAttrName("valid","id"),VALID_NODE_SHOW_ATTR=Smart.optionAttrName("valid","show"),VALID_NODE_BLUR_IG_ATTR=Smart.optionAttrName("valid","blur-ig"),ITEM_ROLE_SELECTOR="*["+Smart.optionAttrName("valid","role")+"='item']",MSG_ROLE_SELECTOR="*["+Smart.optionAttrName("valid","role")+"='msg']",NODE_ORIGINAL_VALID_MSG_KEY="s-valid-original-msg",LEVELS={success:{style:"s-class",key:"success"},warning:{style:"w-class",key:"warning"},error:{style:"e-class",key:"error"}};Smart.widgetExtend({id:"valid",options:"ctx:msg,ctx:show,s-class,e-class,w-class,blur,ctx:validators",defaultOptions:{msg:DEFAULT_MSG,blur:!0,"s-class":"has-success","e-class":"has-error","w-class":"has-warning",show:function(a,b,c){c=c||LEVELS.error;var d=a.closest(ITEM_ROLE_SELECTOR),e=$(MSG_ROLE_SELECTOR,d);void 0==a.data(NODE_ORIGINAL_VALID_MSG_KEY)&&a.data(NODE_ORIGINAL_VALID_MSG_KEY,e.html()),d.removeClass(this.options.valid["s-class"]+" "+this.options.valid["e-class"]+" "+this.options.valid["w-class"]),d.addClass(this.options.valid[c.style]),$(MSG_ROLE_SELECTOR,d).html(b||a.data(NODE_ORIGINAL_VALID_MSG_KEY)||"")}},addValidators:addValidators,setValidatorMsg:setValidatorMsg},{onPrepare:function(){if(this.options.valid.blur){var a=this;this.node.delegate(VALID_NODE_SELECTOR,"blur",function(){"true"!=$(this).attr(VALID_NODE_BLUR_IG_ATTR)&&a.validateNode($(this))})}if(this.options.valid.validators){for(var b={},c=0;c<this.options.valid.validators.length;c++){var d=this.options.valid.validators[c];b[d.id]=d}this.dataTable("valid","validatorMap",b)}this.dataTable("valid","validateItemMap",{})}},{validate:function(){var a=this.node.find(VALID_NODE_SELECTOR),b=[],c=this;return a.each(function(){var a=$(this);b.push(function(){return c.validateNode(a)})}),Smart.deferredQueue(b)},validateNode:function(a){var b=a.attr(VALID_NODE_ID_ATTR),c=this.options.valid.msg[b]||{},d=a.attr(VALID_NODE_ERROR_ATTR),e=a.attr(VALID_NODE_LABEL_ATTR),f=[],g=this,h=a.attr(VALID_NODE_SHOW_ATTR);h&&(h=this.context(h));var i={id:b,label:e?e:"",node:a,value:a.val()},j=this.dataTable("valid","validateItemMap");void 0!=b&&(j[b]=i);var k,l="";d&&f.push(function(){var b=$.Deferred(),e=c.error||{};return executeExp(g,d,e,i,j).done(function(a,c){l=a,k=c||LEVELS.success,b.resolve()}).fail(function(d,e){k=e||LEVELS.error,(h||g.options.valid.show).call(g,a,d||c[k.key+"Msg"]||"",k),b.reject()}),b});var m=a.attr(VALID_NODE_WARNING_ATTR);return m&&f.push(function(){var a=$.Deferred(),b=c.warning||{};return executeExp(g,m,b,i,j).always(function(b){l=b,a.resolve()}).done(function(a,b){k=b||LEVELS.success}).fail(function(a,b){k=b||LEVELS.warning}),a}),f.push(function(){(h||g.options.valid.show).call(g,a,c[k.key+"Msg"]||l||"",k)}),Smart.deferredQueue(f)}}),Validation.prototype={putVar:function(a,b){this.varMap[a]=b},getItemById:function(a){return this._validateItemMap[a]},processMsg:function(a){var b=/(\{.+?\})/g,c=this;return a.replace(b,function(a){var b=c.varMap[a.substring(1,a.length-1)];return void 0!=b?b:""})},interrupt:function(){this._interrupt=!0},interrupted:function(){return this._interrupt}};var validatorMap={};addValidators([{id:"require",valid:function(a){return a=void 0==a?!0:a,a&&Smart.isEmpty(this.value)?0:!a&&Smart.isEmpty(this.value)?(this.interrupt(),1):1},msg:{0:"{label}不能为空"}},{id:"remote",valid:function(a,b,c){var d=$.Deferred();return a=a.replace("{val}",this.value),this.smart.get(a,null,null,{silent:!0}).done(function(a){var e,f;"object"==$.type(a)?(e=a[b||"code"],f=a[c||"msg"]):e=a,d.resolve(e,f)}),d.promise()},msg:{0:"验证不通过"}},{id:"email",valid:function(){var a=/^[a-z]([a-z0-9]*[-_]?[a-z0-9]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+[\.][a-z]{2,3}([\.][a-z]{2})?$/i;return function(){return a.test(this.value)?1:0}}(),msg:{0:"{label|Email}输入格式不正确"}},{id:"regex",valid:function(a){return a.test(this.value)?1:0},msg:{0:"{label}输入格式不正确"}},{id:"checked",valid:function(){return this.item.node.prop("checked")?1:0}},{id:"len",valid:function(a,b){var c=$.trim(this.value);if(b){if(c.length<a)return this.putVar("min_len",a),-2;if(c.length>b)return this.putVar("max_len",b),-3}else if(c.length!=a)return this.putVar("len",a),-1;return 1},msg:{"-1":"{label}长度必须为{len}位","-2":"{label}长度不能小于{min_len}位","-3":"{label}长度不能大于{max_len}位"}},{id:"range",valid:function(a,b){return this.value<a?(this.putVar("min",a),-1):this.value>b?(this.putVar("max",b),-2):1},msg:{"-1":"{label}不能小于{min}","-2":"{label}不能大于{max}"}},{id:"word",valid:function(){var a=/^[A-Za-z0-9_\-]*$/;return function(){return a.test(this.value)?1:0}}(),msg:{0:"{label}只能是字母、数字、下划线、中划线的组合"}},{id:"words",valid:function(){var a=/^[A-Za-z0-9_\-\s]*$/;return function(){return a.test(this.value)?1:0}}(),msg:{0:"{label}只能是字母、数字、下划线、中划线、空格的组合"}},{id:"non_char",valid:function(a){if(!a)return 1;for(var b=0;b<a.length;b++)if(-1!=this.value.indexOf(a[b]))return this.putVar("char",a[b]),0;return 1},msg:{0:"{label}中不能包含{char}字符"}},{id:"eq",valid:function(a){var b=this.getItemById(a);return void 0==b?-1:this.value!=b.value?(this.putVar("t_label",b.label),0):1},msg:{1:"{label}输入正确",0:"{label}与{t_label}输入不一致","-1":"未找到比较的对象"}},{id:"number",valid:function(){return isNaN(this.value)?0:1},msg:{0:"{label}只能输入数字"}},{id:"ip",valid:function(){var a=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;return function(){return a.test(this.value)?1:0}}(),msg:{0:"{label|ip}格式输入不正确"}},{id:"url",valid:function(){var a="^((https|http|ftp|rtsp|mms)?://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$";return function(){var b=new RegExp(a);return b.test(this.value)?1:0}}(),msg:{0:"{label|url}格式输入不正确"}}])}(jQuery),function(){var a={warning:{sign:"glyphicon glyphicon-exclamation-sign",color:"text-warning"},info:{sign:"glyphicon glyphicon-info-sign",color:"text-info"},success:{sign:"glyphicon glyphicon-ok-sign",color:"text-success"},danger:{sign:"glyphicon glyphicon-remove-sign",color:"text-danger"}},b=a.info,c={title:"提示",btnName:"确定"};Smart.extend(Smart.prototype,{alert:function(d,e,f){var g=$.Deferred(),h=Smart.UI.template("alert"),i=a[e]||b;f=f||c,"string"==$.type(f)&&(f=$.extend($.extend({},c),{title:f})),$("*[s-ui-alert-role='title']",h).html(f.title),$("*[s-ui-alert-role='message']",h).html(d),$("*[s-ui-alert-role='sign']",h).addClass(i.color).addClass(i.sign);var j=$("*[s-ui-alert-role='btn']",h);return j.html(f.btnName),Smart.UI.backdrop(),$(h).on("hide.bs.modal",function(){Smart.UI.backdrop(!1).done(function(){g.resolve()})}).on("hidden.bs.modal",function(){$(this).remove()}).on("shown.bs.modal",function(){j.focus()}).css("zIndex",Smart.UI.zIndex()).modal({keyboard:!1,backdrop:!1}),g}})}(),function(a){var b={warning:{sign:"glyphicon glyphicon-exclamation-sign",color:"text-warning"},info:{sign:"glyphicon glyphicon-info-sign",color:"text-info"},success:{sign:"glyphicon glyphicon-ok-sign",color:"text-success"},danger:{sign:"glyphicon glyphicon-remove-sign",color:"text-danger"}},c=b.warning;Smart.fn.extend({confirm:function(d,e){var f=a.Deferred(),g=Smart.UI.template("confirm"),h={title:"提示",sureBtnName:"确定",cancelBtnName:"取消",sign:"info"};e=a.extend(h,e||{}),"string"==a.type(e)&&(e=a.extend(a.extend({},h),{sign:e}));var i=b[e.sign]||c;a("*[s-ui-confirm-role='title']",g).html(e.title),a("*[s-ui-confirm-role='message']",g).html(d),a("*[s-ui-confirm-role='sign']",g).addClass(i.color).addClass(i.sign);var j=a("*[s-ui-confirm-role='sureBtn']",g).html(i.sureBtnName),k=a("*[s-ui-confirm-role='cancelBtn']",g).html(i.cancelBtnName);Smart.UI.backdrop();var l=0;return j.click(function(){l=1,g.modal("hide")}),k.click(function(){l=0,g.modal("hide")}),a(g).on("hide.bs.modal",function(){Smart.UI.backdrop(!1).done(function(){f[l?"resolve":"reject"]()})}).on("hidden.bs.modal",function(){a(this).remove()}).css("zIndex",Smart.UI.zIndex()).modal({keyboard:!1,backdrop:!1}),f}})}(jQuery),function(a){var b="对话框",c=function(b){var c=a('<button class="btn" type="button"></button>');b.id&&c.attr("s-ui-dialog-btn-id",b.id);var d=(b.icon?"<i style='"+b.icon+"'></i>":"")+b.name;return c.html(d),b.style&&c.addClass(b.style||"btn-default"),c.click(b.click),c},d=function(a){Smart.UI.backdrop(),a.on("hide.bs.modal",function(){Smart.UI.backdrop(!1)}).css("zIndex",Smart.UI.zIndex()).modal({keyboard:!1,backdrop:!1})};Smart.fn.extend({dialogOpen:function(){function e(b){return a("button[s-ui-dialog-btn-id='"+b+"']",m)}var f=a.Deferred(),g=Smart.UI.template("dialog"),h=a("<div s='window' />"),i=Smart.of(h),j=a("*[s-ui-dialog-role='body']",g),k=Smart.of(j),l=a("*[s-ui-dialog-role='title']",g),m=a("*[s-ui-dialog-role='footer']",g),n=a("*[s-ui-dialog-role='close']",g),o=a("*[s-ui-dialog-role='dialog']",g);return k.setNode(h),n.click(function(){i.closeWithConfirm()}),i.on("close",function(a){var b=a.deferred,c=Smart.SLICE.call(arguments,1);g.on("hidden.bs.modal",function(){b.resolve(),g.remove(),f.resolve.apply(f,c)}),g.modal("hide"),a.deferred=b.promise()}).on("load",function(){l.html(i.meta.title||b),i.meta.btns&&a.each(i.meta.btns,function(a,b){m.append(c(b))}),i.meta.height&&h.height(i.meta.height),i.meta.width&&h.width(i.meta.width),o.css("position","absolute"),g.appendTo("body"),o.width(g.innerHeight()).css("position","relative"),d(g)}).on("dialog.btn.disable",function(a,b){e(b).prop("disabled",!0)}).on("dialog.btn.enable",function(a,b){e(b).prop("disabled",!1)}),i.load.apply(i,a.makeArray(arguments)),f}})}(jQuery),function(){var a={setTarget:function(a){this.node=a},onBegin:function(){this.progress=Smart.UI.template("progress").css({position:"absolute",zIndex:Smart.UI.zIndex()}).addClass("s-ui-upload-progressbar"),this.progress.width(this.node.innerWidth()),this.progress.appendTo("body"),this.progressbar=this.progress.children()},onProgress:function(a){this.progress.position({of:this.node,at:"left bottom+5",my:"left top"}),this.progressbar.width(a+"%")},onDone:function(){var a=this;setTimeout(function(){a.progress.fadeOut(function(){$(this).remove()})},1500)}};Smart.extend({uploadSetting:function(b){b=b||{},b.listener&&(a=b.listener)}}),Smart.fn.extend({upload:function(b,c,d){var e=Smart.formData(c);return d=d||a,$.isFunction(d)&&(d={onProgress:d}),d.setTarget&&d.setTarget(c),d.onBegin&&d.onBegin(),this.post(b,e,null,null,{xhr:function(){var a=$.ajaxSettings.xhr();return a.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=100*a.loaded/a.total;d.onProgress(b,a.total,a.loaded)}},!1),a}}).always(function(){d.onDone&&d.onDone()})}})}();
//# sourceMappingURL=ismart.all.min.map