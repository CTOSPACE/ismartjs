<meta title="valid验证插件" />
<div>
    <h2 class="page-header">valid验证控件</h2>
    <p>使用此插件可以验证表单元素是否输入正确</p>
    <hr />
    <h3 id="define" s-window-role="a" title="1. 控件定义">1. 控件定义</h3>
    <p><code>&lt;form s="valid"&gt;....&lt;/form&gt;</code></p>
    <h4>a. 配置参数</h4>
    <ol>
        <li><abbr class="text-warning" title="闭包参数">ctx</abbr> <code>msg</code>：非必须，自定义的验证提示消息，该配置的消息会覆盖验证器中的Msg配置。</li>
        <li><abbr class="text-warning" title="闭包参数">ctx</abbr> <code>show</code>：非必须，处理验证结果的方法，主要用来提示验证结果。</li>
        <li><code>blur</code>：非必须，当验证项失去焦点的时候是否触发验证，默认为true</li>
        <li><code>s-class</code>：非必须，当验证通过的时候为验证项添加的class，默认为 <code>has-success</code></li>
        <li><code>w-class</code>：非必须，当验证为warning的时候为验证项添加的class，默认为<code>has-warning</code></li>
        <li><code>e-class</code>：非必须，当验证为error的时候为验证项添加的class，，默认为<code>has-error</code></li>
        <li><abbr class="text-warning" title="闭包参数">ctx</abbr> <code>validators</code>：非必须，仅仅作用于当前验证的自定义验证器，如果想要添加全局验证器，请参考api</li>
    </ol>
    <h4>b. 验证规则定义</h4>
    <ol>
        <li><code>s-valid-error='...'</code>： 必须配置，错误验证的规则，当配置的规则不满足时，则不会验证通过。所有需要验证的元素都需要配置该属性，值为验证规则的表达式，如：
            <code>require(),len(6,12),regex(/^[a-z0-9_-]{6,16}$/g),remote('json/valid-username.json')</code></li>
        <li><code>s-valid-warning='...'</code>： 非必须，警告验证的规则，如：检测密码的强度等，验证失败不会影响验证结果，仅仅做提示。warning验证在error验证通过之后。</li>
        <li><code>s-valid-id='...'</code>： 非必须，验证元素的验证id，必须唯一。</li>
        <li><code>s-valid-label='...'</code>： 非必须，验证元素的label。</li>
        <li><code>s-valid-role='item'</code>： 非必须，用于声明一个验证项，对于默认的消息处理方法(<code>show</code>)时必须配置。</li>
        <li><code>s-valid-role='msg'</code>： 非必须，显示验证提示的元素，非必须，当使用默认的消息处理方法(<code>show</code>方法)时必须配置。</li>
        <li><code>s-valid-blur-ig='true'</code>： 非必须，声明不进行blur验证的元素。</li>
        <li><code>s-valid-show='fn'</code>： 非必须，声明当前验证元素的验证结果处理方法。如果配置该方法，
            将取而代之全局和控件级别的 <code>show</code> 方法处理元素的验证结果，该方法必须在当前的闭包中声明，参数同声明全局和控件级别的 <code>show</code> 方法一致。</li>
    </ol>
    <hr />
    <h3 s-window-role="a" id="example" title="2. 示例">2. 示例</h3>
    <form s="valid,submit" s-valid-msg="form1ValidMsg" s-valid-validators="form1Validators" id="validForm1" role="form" style="width:500px;">
        <div class="form-group has-feedback" s-valid-role="item">
            <label class="control-label" >用户名</label>
            <input s-valid-id="username"
                   s-valid-error="require(),len(6,12),regex(/^[a-z0-9_-]{6,16}$/g),remote('json/valid-username.json')"
                   s-valid-label="用户名" type="text" class="form-control"  />
            <span s-valid-role="msg" class="help-block">用户名必须是6到16位的小写字母、数字、下划线、中划线的组合</span>
            <span class="glyphicon glyphicon-ok form-control-feedback s-valid-feedback-success"></span>
            <span class="glyphicon glyphicon-warning-sign form-control-feedback s-valid-feedback-warning"></span>
            <span class="glyphicon glyphicon-remove form-control-feedback s-valid-feedback-error"></span>
        </div>
        <div class="form-group has-feedback" s-valid-role="item">
            <label class="control-label" >密码</label>
            <input s-valid-id="password"
                   s-valid-error="require(),len(6,12),checkEqual(123456)"
                   s-valid-warning="regex(/(?=.*[a-zA-Z])(?=.*[0-9])/),regex(/(?=.*[A-Z])(?=.*[a-z])/)"
                   s-valid-label="密码" type="password" class="form-control" />
            <span s-valid-role="msg" class="help-block" >密码必须长度必须为6到12位</span>
            <span class="glyphicon glyphicon-ok form-control-feedback s-valid-feedback-success"></span>
            <span class="glyphicon glyphicon-warning-sign form-control-feedback s-valid-feedback-warning"></span>
            <span class="glyphicon glyphicon-remove form-control-feedback s-valid-feedback-error"></span>
        </div>
        <div class="form-group has-feedback" s-valid-role="item">
            <label class="control-label" >确认密码</label>
            <input  s-valid-id="confirmPwd"
                    s-valid-error="require(),eq('password')"
                    s-valid-label="确认密码"
                    type="password" class="form-control" />
            <span s-valid-role="msg" class="help-block" >确认密码需与密码保持一致</span>
            <span class="glyphicon glyphicon-ok form-control-feedback s-valid-feedback-success"></span>
            <span class="glyphicon glyphicon-warning-sign form-control-feedback s-valid-feedback-warning"></span>
            <span class="glyphicon glyphicon-remove form-control-feedback s-valid-feedback-error"></span>
        </div>
        <div class="form-group has-feedback" s-valid-role="item">
            <label class="control-label" >（可选）年龄</label>
            <input s-valid-error="require(false),number(),range(18,130)"
                   s-valid-label="年龄"
                   type="text" class="form-control" />
            <span s-valid-role="msg" class="help-block" >18-130的数字</span>
            <span class="glyphicon glyphicon-ok form-control-feedback s-valid-feedback-success"></span>
            <span class="glyphicon glyphicon-warning-sign form-control-feedback s-valid-feedback-warning"></span>
            <span class="glyphicon glyphicon-remove form-control-feedback s-valid-feedback-error"></span>
        </div>
        <div class="checkbox" s-valid-role="item">
            <label>
                <input s-valid-show="alertShow"
                       s-valid-blur-ig="true"
                       s-valid-id="tk"
                       type="checkbox" s-valid-error="checked()"  /> 我已经同意了条款
            </label>
            <span s-valid-role="msg" class="help-block" >你需要详细阅读条款，并且同意此条款才能继续</span>
        </div>
        <button type="submit" s="click" s-click-action="submitValidForm1()" class="btn btn-primary">提交验证</button>
    </form>
    <script type="text/javascript">
        function submitValidForm1(){
            S.S("#validForm1").validate().done(function(){
                S.alert("验证成功");
            }).fail(function(){
//                S.alert("验证失败");
            });
        }

        function alertShow(node, msg, level){
            if(level.key == "error"){
                S.alert(msg);
            }
        }

        var form1ValidMsg = {
            "username": {
                'error': {
                    "remote": {
                        msg: {
                            '0': "用户名已经存在",
                            '-1': "用户名已经被冻结",
                            "100": "恭喜你，该用户名可以注册"
                        },
                        successCode: "100"
                    }
                }
            },
            "password": {
                'error':{
                    "checkEqual": {
                        msg : {
                            '0': "{label}不能是{value}"
                        }
                    }
                },
                'warning': {
                    regex: {
                        msg: {'0': "密码强度弱"}
                    },
                    'regex#1': {
                        msg: {
                            '0': 'success:密码强度中',
                            '1': "密码强度强"
                        }
                    }
                }
            },
            "tk":{
                errorMsg: "你还未同意条款，请先同意条款"
            }
        };

        var form1Validators = [
            {
                id: "checkEqual",
                valid: function(value){
                    this.putVar("value", value);
                    if(this.value == value) return 0;
                    return 1;
                }
            }
        ]

    </script>
    <h4>源码</h4>
<pre>
&lt;form s="valid" <abbr class="text-warning" title="当前控件使用的自定义提示消息">s-valid-msg="form1ValidMsg"</abbr> <abbr class="text-warning" title="当前控件使用的自定义验证器">s-valid-validators="form1Validators"</abbr>
    id="validForm1" role="form" style="width:500px;"&gt;
    &lt;div class="form-group has-feedback" <abbr title="验证项的定义，对使用默认消息提示的控件有效" class="text-warning">s-valid-role="item"</abbr>&gt;
        &lt;label class="control-label" &gt;用户名&lt;/label&gt;
        &lt;input <abbr title="验证元素的id" class="text-warning">s-valid-id="username"</abbr>
               <abbr title="错误验证的验证规则，不通过该规则验证的不通过验证" class="text-danger">s-valid-error="require(),len(6,12),regex(/^[a-z0-9_-]{6,16}$/g),remote('json/valid-username.json')"</abbr>
               <abbr title="验证元素的标签，用于在消息提示的时候替换{label}的占位符" class="text-warning">s-valid-label="用户名"</abbr> type="text" class="form-control"  /&gt;
        &lt;span <abbr title="显示验证消息的元素" class="text-warning">s-valid-role="msg"</abbr> class="help-block"&gt;用户名必须是6到16位的小写字母、数字、下划线、中划线的组合&lt;/span&gt;
        &lt;span class="glyphicon glyphicon-ok form-control-feedback s-valid-feedback-success"&gt;&lt;/span&gt;
        &lt;span class="glyphicon glyphicon-warning-sign form-control-feedback s-valid-feedback-warning"&gt;&lt;/span&gt;
        &lt;span class="glyphicon glyphicon-remove form-control-feedback s-valid-feedback-error"&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;div class="form-group has-feedback" <abbr title="验证项的定义，对使用默认消息提示的控件有效" class="text-warning">s-valid-role="item"</abbr>&gt;
        &lt;label class="control-label" &gt;密码&lt;/label&gt;
        &lt;input <abbr title="验证元素的id" class="text-warning">s-valid-id="password"</abbr>
               <abbr title="错误验证的验证规则，不通过该规则验证的不通过验证" class="text-danger">s-valid-error="require(),len(6,12),checkEqual(123456)"</abbr>
               <abbr title="警告验证的验证规则，不通过该规则验证的仅仅做警告处理" class="text-warning">s-valid-warning="regex(/(?=.*[a-zA-Z])(?=.*[0-9])/),regex(/(?=.*[A-Z])(?=.*[a-z])/)"</abbr>
               <abbr title="验证元素的标签，用于在消息提示的时候替换{label}的占位符" class="text-warning">s-valid-label="密码"</abbr> type="password" class="form-control" /&gt;
        &lt;span <abbr title="显示验证消息的元素" class="text-warning">s-valid-role="msg"</abbr> class="help-block" &gt;密码必须长度必须为6到12位&lt;/span&gt;
        &lt;span class="glyphicon glyphicon-ok form-control-feedback s-valid-feedback-success"&gt;&lt;/span&gt;
        &lt;span class="glyphicon glyphicon-warning-sign form-control-feedback s-valid-feedback-warning"&gt;&lt;/span&gt;
        &lt;span class="glyphicon glyphicon-remove form-control-feedback s-valid-feedback-error"&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;div class="form-group has-feedback" <abbr title="验证元素的id" class="text-warning">s-valid-role="item"</abbr>&gt;
        &lt;label class="control-label" &gt;确认密码&lt;/label&gt;
        &lt;input  s-valid-id="confirmPwd"
                <abbr title="错误验证的验证规则，不通过该规则验证的不通过验证" class="text-danger">s-valid-error="require(),eq('password')"</abbr>
                s-valid-label="确认密码"
                type="password" class="form-control" /&gt;
        &lt;span s-valid-role="msg" class="help-block" &gt;确认密码需与密码保持一致&lt;/span&gt;
        &lt;span class="glyphicon glyphicon-ok form-control-feedback s-valid-feedback-success"&gt;&lt;/span&gt;
        &lt;span class="glyphicon glyphicon-warning-sign form-control-feedback s-valid-feedback-warning"&gt;&lt;/span&gt;
        &lt;span class="glyphicon glyphicon-remove form-control-feedback s-valid-feedback-error"&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;div class="form-group has-feedback" s-valid-role="item"&gt;
        &lt;label class="control-label" &gt;（可选）年龄&lt;/label&gt;
        &lt;input s-valid-error="<abbr title="非必须，当验证为空之后不会验证后续的规则，直接验证通过" class="text-warning">require(false)</abbr>,number(),range(18,130)"
               s-valid-label="年龄"
               type="text" class="form-control" /&gt;
        &lt;span s-valid-role="msg" class="help-block" &gt;18-130的数字&lt;/span&gt;
        &lt;span class="glyphicon glyphicon-ok form-control-feedback s-valid-feedback-success"&gt;&lt;/span&gt;
        &lt;span class="glyphicon glyphicon-warning-sign form-control-feedback s-valid-feedback-warning"&gt;&lt;/span&gt;
        &lt;span class="glyphicon glyphicon-remove form-control-feedback s-valid-feedback-error"&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;div class="checkbox" s-valid-role="item"&gt;
        &lt;label&gt;
            &lt;input <abbr title="定义处理该元素验证结果的方法" class="text-success">s-valid-show="alertShow"</abbr>
                   <abbr title="忽略blur验证" class="text-success">s-valid-blur-ig="true"</abbr>
                   s-valid-id="tk"
                   s-valid-error="checked()"
                   type="checkbox" /&gt; 我已经同意了条款
        &lt;/label&gt;
        &lt;span s-valid-role="msg" class="help-block" &gt;你需要详细阅读条款，并且同意此条款才能继续&lt;/span&gt;
    &lt;/div&gt;
    &lt;button type="submit" s="submit,click" s-click-action="submitValidForm1()" class="btn btn-primary"&gt;提交验证&lt;/button&gt;
&lt;/form&gt;
&lt;script type="text/javascript"&gt;
    function submitValidForm1(){
        <span class="text-warning">
        /**
         * 调用控件的 validate 方法进行验证，该方法是一个异步方法，返回值是一个$.Deferred对象，如果全部验证规则验证通过，则会resolve，否则则会reject。
         **/
        S.S("#validForm1").validate().done(function(){
            S.alert("验证成功");
        }).fail(function(){
//                S.alert("验证失败");
        });</span>
    }

    <span class="text-warning">// 处理条款复选框验证消息的提示方法。</span>
    function alertShow(node, msg, level){
        if(level.key == "error"){
            S.alert(msg);
        }
    }

    <span class="text-warning">/** 自定义的验证提示消息
        ** 声明 s='valid' s-valid-msg="form1ValidMsg"
        **/</span>
    var form1ValidMsg = {
        <abbr class="text-warning" title="验证规则元素的id，即配置 s-valid-id='username' 的元素">"username"</abbr>: {
            <abbr class="text-warning" title="错误验证的验证器消息提示，作用于当 s-valid-error 配置的验证规则验证错误的时候">'error'</abbr>: {
                <abbr title="remote验证器验证错误的消息提示" class="text-warning">"remote"</abbr>: {
                    msg: {
                        <abbr title="验证器的返回错误码，0是默认的表示验证错误。" class="text-warning">'0'</abbr>: <abbr title="错误码对应的提示信息" class="text-warning">"用户名已经存在"</abbr>,<span class="text-warning">//错误码:提示信息</span>
                        '-1': "用户名已经被冻结",
                        "100": "恭喜你，该用户名可以注册"
                    },
                    <abbr title="验证正确的返回码，即当返回码为100的时候验证通过，默认值为1">successCode</abbr>: "100"
                }
            }
        },
        "password": {
            'error':{
                <abbr class="text-warning" title="自定义的验证器，参考代码最后">"checkEqual"</abbr>: {<span class="text-warning">//checkEqual是一个自定义的验证期，参考代码最后</span>
                    msg : {
                        '0': "{label}不能是{value}"
                    }
                }
            },
            <abbr class="text-warning" title="警告验证的验证器消息提示，作用于当 s-valid-warning 配置的验证规则验证错误的时候">'warning'</abbr>: {
                regex: {
                    msg: {'0': "密码强度弱"}
                },
                <span class="text-warning">/**当同一个验证规则中，出现多个相同的验证器的时候，
                * 通过 # 号来匹配第几个验证器，这里表示匹配 password 警告验证规则中的第二个regex验证器
                **/</span>
                <abbr class="text-warning" title="当同一个验证规则中，出现多个相同的验证器的时候，通过 # 号来匹配第几个验证器，这里表示匹配 password 警告验证规则中的第二个regex验证器">'regex<strong class="text-success">#1</strong>'</abbr>: {
                    msg: {
                        <span class="text-warning">'0': 'success:密码强度中',//success: 表示该code的提示信息使用success的级别来提示，仅仅对显示有效</span>
                        '1': "密码强度强"
                    }
                }
            }
        },
        "tk":{
            <span class="text-warning">errorMsg: "你还未同意条款，请先同意条款"//默认的错误提示信息，相同的还可以配置 successMsg, warningMsg。</span>
        }
    };

    <span class="text-warning">/**
     ** 自定义的验证规则
     ** 声明 s='valid' s-valid-validators="form1Validators"
     **/</span>
    var form1Validators = [
        {
            id: "checkEqual",
            valid: function(value){
                <span class="text-warning">//保存变量，用于处理消息中的占位符，在消息配置中可以使用 {value} 来配置占位符。
                this.putVar("value", value);</span>
                if(this.value == value) return 0;
                return 1;
            }
        }
    ]

&lt;/script&gt;    
</pre>
<hr />
<h3 id="validators" s-window-role="a" title="3. 内置的验证器">3. 内置的验证器</h3>
<table class="table table-bordered table-striped table-hover">
    <thead>
    <tr>
        <th>验证器</th>
        <th>描述</th>
        <th>示例</th>
        <th>其他</th>
    </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>require(true|false)</code></td>
            <td>为空验证器，参数可以为空，为空表示true，当参数值是false的时候，如果验证通过，则不会继续验证后面的规则。</td>
            <td><code>s-valid-error="require()"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>remote(url, codeKey, msgKey)</code></td>
            <td>
                通过url进行远程验证，使用 <code>{val}</code> 配置url的占位符，
                请求url的时候会把当前元素的value替换掉 <code>{val}</code> 之后再去请求。
                <br />参数说明：
                <ol>
                    <li><code>url</code>：要请求的url，url中可以使用 <code>{val}</code> 作为验证元素值的占位符。</li>
                    <li><code>codeKey</code>：url返回的json中，通过该codeKey获取消息码，默认为 <code>code</code></li>
                    <li><code>msgKey</code>：url返回的json中，通过该msgKey获取消息提示信息，默认为 <code>msg</code></li>
                </ol>
                url的返回值,url的返回值可以是如下格式：
                <ol>
                    <li><code>字符串或者整数格式</code>：直接把返回值作为消息码处理</li>
                    <li><code>json对象</code>：该对象包含了消息码和消息提示文本，通过codeKey去获得消息码，通过msgKey去获得消息提示文本</li>
                </ol>
            </td>
            <td><code>s-valid-error="require()"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>email()</code></td>
            <td>电子邮件格式验证器，验证正确返回1，验证错误返回0</td>
            <td><code>s-valid-error="email()"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>regex(Regex)</code></td>
            <td>正则表达式验证器，参数是正则表达式对象，验证正确返回1，验证错误返回0</td>
            <td><code>s-valid-error="regex(/(?=.*[a-zA-Z])(?=.*[0-9])/)"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>checked()</code></td>
            <td>验证checkbox或者radio是否被选中，选中返回1，没有选中返回0</td>
            <td><code>s-valid-error="checked()"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>len(min_len,max_len)</code></td>
            <td>长度验证器，验证正确返回1，验证错误返回0
            <br />
                参数：
                <ol>
                    <li><code>min_len</code>：最小长度，如果 <code>max_len</code> 不存在，则验证长度是否等于 <code>min_len</code></li>
                    <li><code>max_len</code>：最大长度</li>
                </ol>
            </td>
            <td><code>s-valid-error="min(10,20)"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>range(min,max)</code></td>
            <td>值范围验证器，验证正确返回1，验证错误返回0
                <br />
                参数：
                <ol>
                    <li><code>min</code>：最小值</li>
                    <li><code>max</code>：最大值</li>
                </ol>
            </td>
            <td><code>s-valid-error="range(10,20)"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>word()</code></td>
            <td>字符验证器，匹配大小写字母，数字，下划线、中划线的组合，相当于正则 /^[A-Za-z0-9_\-]*$/ 验证，验证正确返回1，验证错误返回0</td>
            <td><code>s-valid-error="word()"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>words()</code></td>
            <td>字符句子的验证器，匹配大小写字母，数字，下划线、中划线、空格的组合，相当于正则 /^[A-Za-z0-9_\-\s]*$/ 验证，验证正确返回1，验证错误返回0</td>
            <td><code>s-valid-error="words()"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>non_char(chars)</code></td>
            <td>非字符验证，验证是否包含指定的字符，如果包含则验证不通过，返回0，否则返回1</td>
            <td><code>s-valid-error="non_char('@#!$%^_\'"')"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>eq(id)</code></td>
            <td>等值比较器，参数为 验证规则元素的id，判断当前元素与 <code>s-valid-id</code> 等于id的元素的值是否相等，相等返回1，否则返回0，常用来验证确认密码是否与密码一致。</td>
            <td><code>s-valid-error="eq('password')"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>number()</code></td>
            <td>判断当前元素的值是否是数字，如果是返回1，否则返回0</td>
            <td><code>s-valid-error="number()"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>ip()</code></td>
            <td>判断当前元素的值是否是ip地址的格式，如果是返回1，否则返回0</td>
            <td><code>s-valid-error="ip()"</code></td>
            <td></td>
        </tr>
        <tr>
            <td><code>url()</code></td>
            <td>判断当前元素的值是否是url格式，如果是返回1，否则返回0</td>
            <td><code>s-valid-error="url()"</code></td>
            <td></td>
        </tr>
    </tbody>
</table>
<hr />
<div id="custorm" s-window-role="a" title="4. 自定义扩展">4. 自定义扩展</div>
<p >验证器控件提供了强大的自定义功能，包括 自定义全局验证器、自定义全局消息提示方法、自定义全局defaultOptions的值，自定义控件范围的验证器，自定义控件范围的消息提示方法，自定义验证元素的消息提示方法，自定义消息提示等，下面我们来一一陈述。</p>
<div id="custormValidators" s-window-role="a" title="4.1 自定义验证器">4.1 自定义验证器</div>
<p>使用API<code>Smart.getWidgetDef('valid').addValidators([validator])</code> 方法来添加全局的验证器。</p>
<p>使用<code>s-valid-validators="validators"</code> 配置来为当前验证控件添加验证器，这样声明的验证器仅仅作用于当前控件。</p>
<h4><code>validator</code> 的格式参考如下：</h4>
<pre>
{
    id: "validator1",<span class="text-warning">//validator的id</span>
    valid: function ([arg1[,arg2[,arg3[,..]]]) {<span class="text-warning">//声明valid方法</span>
        ...
        <span class="text-warning">//this的api参考下面的说明</span>
        this.putVar(key, value);<span class="text-warning">//该方法是保存变量，用于替换消息中的 {key} 的占位符</span>
        ...
    },
    msg: {<span class="text-warning">//消息提示，key对应的是valid方法的返回值</span>
        "-1": "{label}长度必须为{len}位",
        "-2": "{label}长度不能小于{min_len}位",
        "-3": "{label}长度不能大于{max_len}位"
    },
    successCode: 1<span class="text-warning">//配置验证正确的返回码，可以不用定义，默认是1</span>
}
</pre>
<h4 id="validDefine" s-window-role="a" title="4.1.a <code>valid</code> 方法定义说明">a. <code>valid</code> 方法定义说明：</h4>
<ol>
    <li><code>参数定义</code>：valid方法的定义参数，在配置验证规则的时候需要传入，
        如 长度验证器 <code>len</code> 的 <code>valid</code> 定义为：<code>function valid(min_len,max_len){...}</code>，则配置验证规则的时候传入参数 <code>s-valid-error='require(),len(10,20)'</code>
    </li>
    <li>
        <code>返回值定义</code>：valid方法的返回值可以是 <code>消息码</code> 或者 <code>$.Deferred</code> 对象，
        如果是 <code>消息码</code>，则根据该消息码去判断是否验证通过和获取验证消息提示，如果返回值是 <code>$.Deferred</code>，则该验证器是异步验证，deferred通知的时候需要传入 <code>code(消息码)</code> 和 <code>msg(消息提示)</code> 两个参数，如：
        <code>deferred.resolve(code, msg)</code>，msg可以为空，或者 <code>deferred.reject(code, msg)</code>
    </li>
</ol>
<h4 id="validFnThis" s-window-role="a" title="4.1.b <code>valid</code>方法中的<code>this</code>API">b. <code>valid</code> 方法中的 <code>this</code> 引用：</h4>
<p>该this引用是一个 <code>Validation</code> 的实例，通过 <code>this</code> 可以获取验证元素的值和其他信息，具体请参考 <code>Validation</code> 的API，如下：
    <table class="table table-bordered table-striped table-hover">
        <thead>
        <tr>
            <th>API</th>
            <th>描述</th>
            <th>示例</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td><code>this.value</code></td>
            <td>获取当前元素的值</td>
            <td><code>this.value</code></td>
        </tr>
        <tr>
            <td><code>putVar(key,value)</code></td>
            <td>添加变量，用于处理消息中的 <code>{key}</code> 占位符</td>
            <td><code>this.putvar("min_len", min_len)</code></td>
        </tr>
        <tr>
            <td><code>getItemById(id)</code></td>
            <td>根据id获取声明 <code>s-valid-id=id</code> 的验证元素的验证项对象，该对象有如下属性：<br />
                <ol>
                    <li><code>id</code> ：该验证项的id</li>
                    <li><code>node</code>：验证的元素</li>
                    <li><code>value</code>：验证元素的值</li>
                    <li><code>label</code>：验证元素的标签</li>
                </ol>
                <br />通过该方法可以获取对应验证id元素的验证对象，如 <code>eq</code> 验证器，配置的时候需要传递一个验证元素id，用来对比值是否相等，
                <code>eq</code> 验证器中就使用了该方法获取被验证元素的对象，从而获取被验证元素的值。
            </td>
            <td></td>
        </tr>
        <tr>
            <td><code>interrupt()</code></td>
            <td>中断验证规则链的验证，如果该验证器验证后，不需要后续的验证器继续处理，则调用该方法。典型应用在 <code>require</code> 验证器上，
            当 <code>s-valid-error='require(false),len(10,20)'</code> 进行验证的时候，如果验证元素的值是空，则require验证器会调用该方法中断后续验证器的验证，直接通过验证。</td>
            <td><code>this.interrupt()</code></td>
        </tr>
        </tbody>
    </table>
<h4 id="validMsgDefine" s-window-role="a" title="4.1.c 声明msg消息提示">c. 声明msg消息提示</h4>
<p class="lead">通过 <code>消息码</code>:<code>消息</code> 的方式来声明验证消息，消息码对应valid方法返回或者通知的code。</p>
<h4>消息占位符：</h4>
<p>消息占位符最终会被替换成为在验证器验证的过程中使用<code>putVar(key,value)</code>方法put进去的key的值。<code>{label}</code> 是一个预定变量，
    会被 <code>s-valid-label</code> 属性的值所替换。如上述格式参考中的 <code>"-1": "{label}长度必须为{len}位"</code></p>
<hr />
<h3 id="defineMsg" s-window-role="a" title="5. 自定义消息提示">5. 自定义消息提示</h3>
<h4 id="defineGMsg" s-window-role="a" title="5.a 设定修改全局消息提示">5.a 设定修改全局消息提示</h4>
<p>使用 <code>Smart.getWidgetDef(id).setValidatorMsg([msgDef])</code> 设定修改行全局消息提示</p>
<p>msgDef的格式为:</p>
<pre>
{
    id: "验证器id",
    msg: {
        code1: tip1,
        code2: tip2
    }
}
</pre>
<ol>
    <li><code>id</code>：验证器的id，需要修改消息的验证器的id</li>
    <li><code>msg</code>：需要修改的验证器的消息提示，格式为 <code>消息码</code>:<code>消息提示</code>，
        消息码必须在验证器的 <code>valid</code> 方法中有相关定义，否则是无意义的。</li>
</ol>
    <h4 id="defineWMsg" s-window-role="a" title="5.b 设定控件范围的消息提示">5.b 设定控件范围的消息提示</h4>
    <p class="lead">使用 <code>s-valid-msg="msgDef"</code> 属性配置设定修改控件级别的消息提示</p>
<p>msgDef的格式示例为：</p>
<pre>
{
    "<abbr class="text-success" title="s-valid-id 配置的值，如username">password</abbr>": {
        <abbr class="text-warning" title="error级别的定义">'error'</abbr>:{
            "checkEqual": {//checkEqual是一个自定义的验证期，参考代码最后
                msg : {
                    '0': "{label}不能是{value}"
                }
            }
        },
        <abbr class="text-warning" title="warning级别的定义">'warning'</abbr>: {
            regex: {
                msg: {'0': "密码强度弱"}
            },
            /**当同一个验证规则中，出现多个相同的验证器的时候，
            * 通过 # 号来匹配第几个验证器，这里表示匹配 password 警告验证规则中的第二个regex验证器
            **/
            'regex#1': {
                msg: {
                    <span class="text-warning">'0': 'success:密码强度中',//success: 表示该code的提示信息使用success的级别来提示，仅仅对显示有效，或者使用 error:、warning:来声明</span>
                    '1': "密码强度强"
                }
            }
        },
        <span class="text-warning">//当且仅当验证规则中生成的消息为空或者不存在的时候，如下消息配置才会有用。</span>
        errorMsg: "默认的错误消息提示",
        successMsg: "默认的正确消息提示",
        warningMsg:"默认的警告消息提示"
    }
}
</pre>
<hr />
<h3 id="optionDefine" s-window-role="a" title="6. 自定义全局参数">6. 自定义全局参数</h3>
<p class="lead">通过 <code>Smart.widgetOptionsExtend('valid', options)</code> 来配置修改全局参数，options的结构如下：</p>
<h4>options的结构</h4>
<ol>
    <li><code>show</code>：非必须，处理验证结果的方法，主要用来提示验证结果。</li>
    <li><code>blur</code>：非必须，当验证项失去焦点的时候是否触发验证，默认为true</li>
    <li><code>s-class</code>：非必须，当验证通过的时候为验证项添加的class，默认为 <code>has-success</code></li>
    <li><code>w-class</code>：非必须，当验证为warning的时候为验证项添加的class，默认为<code>has-warning</code></li>
    <li><code>e-class</code>：非必须，当验证为error的时候为验证项添加的class，，默认为<code>has-error</code></li>
</ol>
<h4 id="optionShowDefine" s-window-role="a" title="6.1 自定义show方法">6.1 自定义show方法</h4>
<p><code>show</code> 方法接受3个参数， <code>show(node, msg, level)</code>，参数说明如下：</p>
<ol>
    <li><code>node</code>：当前验证元素的jQuery对象</li>
    <li><code>msg</code>：当前提示的验证信息</li>
    <li><code>level</code>：消息的级别（success、error、warning级别中的一种），分别表示验证通过，验证失败，验证警告。level的格式为：
    <code>{key:"success|error|warning", style:"has-success|has-error|has-warning"}</code></li>
</ol>
    <p>可以通过 <code>Smart.widgetOptionsExtend('valid', {show:function(node,msg,level){...}})</code> 来设定全局消息处理方法</p>
<p>也可以在控件定义上使用 <code>s-valid-show="showMsg"</code> 设定控件范围的show方法，
    或者在 验证元素上配置 <code>s-valid-show</code> 来设定验证元素级别的show方法。</p>
</div>